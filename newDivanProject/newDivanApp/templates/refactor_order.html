{% load static %}
{% load humanize %}
{% block content %}

<style>
    body{

        background: #f4f4f4;
        padding: 0;
        margin: 0;
        zoom: 80%;
        overflow-x: hidden;
    }
    .header {
        display: flex;
        align-items: center;
        width: 100%;
        height: 140px;
        background-color: #f4f4f4;
        position: fixed; /* Закрепляем заголовок */
        top: 0; /* Располагаем заголовок в верхней части экрана */
        left: 0; /* Выравниваем заголовок по левому краю */
        z-index: 1000; /* Устанавливаем z-index для того, чтобы заголовок был поверх других элементов */
    }
    .header-container{
        justify-content: space-between;
        margin: auto;
        display: flex;
        width: calc(100% - 141px);
        height: 60px;
    }
    .logo{
        height: 60px;
        width: 60px;
    }

    .navbar{
        margin-bottom:auto;
        margin-top: auto;
        height: 39px;
        width: auto;
        display: inline-flex;
        justify-content: flex-end;
        align-items: center;
        gap: 20px;
    }
    .navbar ul{
        gap: 20px;
        margin: 0;
        width: 100%;
        height: 100%;
        display: flex;
        list-style-type: none;
    }

    .navbar ul li{
        width: 135px;

    }
    a{
        text-decoration: none;
        color: white;
    }
    .navbar a, .about-us-link a{
        color: var(--main-light-grey, #2a2a28);
        text-decoration: none;
    }
    .navbar a:hover, .about-us-link a:hover{
        cursor: pointer;
        color: var(--main-grey, #232323);
        transition: 0.5s;
    }
     /* Стили для остальных пунктов меню */
    .navbar a {
        color: var(--main-light-grey, #2a2a28);
        display: block;
        text-align: center;
        padding: 10px 15px; /* Одинаковые отступы для всех пунктов */
        border-radius: 80px; /* Скругление углов для всех пунктов */
        font-family: "Inter", sans-serif;
        font-size: 18px;

    }

    /* Стили при наведении для всех пунктов меню */
    .navbar a:hover {
        background-color: #2a2a28;; /* Фон для активного пункта меню */
        color: var(--main-grey, #ffffff); /* Фон при наведении */
        text-decoration: none;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 18px;
        text-align: center;
    }
    .navbar .active a {
        background-color: #2a2a28;; /* Фон для активного пункта меню */
        color: var(--main-grey, #ffffff); /* Цвет текста для активного пункта */

    }
    .active{
        font-weight: 700;
        background-color: #2a2a28;; /* Фон для активного пункта меню */
        color: var(--main-grey, #ffffff); /* Цвет текста для активного пункта */
    }

    .nav-tools{
        display: flex;
        justify-content: space-between;
        width: 170px;
        height: 50px;
    }
    .photo-profile{
        border-radius: 100%;
        height: 50px;
        width: 50px;
        background: white;
    }
    .order-create{
        margin-top: 140px;
        width: calc(100% - 141px);
        margin-left: auto;
        margin-right: auto;
    }
    .bact-to-orders{
        margin-bottom: 5px;
        font-family: "TT Fors Trial Variable", sans-serif;
        font-weight: 280;
        font-size: 16px;
        line-height: 100%;
        color: #585858;
        transition: all 0.3s;
    }
    .bact-to-orders:hover{
        color: #7e8230;;
    }
    .order-name{
        padding: 0;
        width: 50%;
        background: none;
        border: none;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 36px;
        color: #2a2a28;
    }

    input:focus {
        outline: none;  /* Убирает стандартное выделение */
    }
    input, select, textarea{
        border: 1px solid #a5a5a5;
        border-radius: 15px;
        padding: 10px;
        width: 340px;
        height: 45px;
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);
        background: #fff;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 18px;
        line-height: 140%;
        color: #2a2a28;
    }
    .point-in-form{
        flex-wrap: wrap;
        margin-bottom: 38px;
        display: flex;
        gap:20px;

    }
    .left-section{
        width: 71%;
    }
    .left-section .submit-button{
        cursor: pointer;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 20px;
        line-height: 140%;
        color: #fff;
        border-radius: 15px;
        width: 339px;
        height: 50px;
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);
        background: #7e8230;
        border: none;
        transition: all 0.3s;
    }
    .left-section .submit-button:hover{
        background: #2a2a28;
        border: none;
    }
    .order-name{
        padding: 0;
        width: 50%;
        background: none;
        border: none;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 36px;
        color: #2a2a28;
    }
    .back-to-orders {
        margin-bottom: 5px;
        font-family: "TT Fors Trial Variable", sans-serif;
        font-weight: 280;
        font-size: 16px;
        line-height: 100%;
        color: #585858;
        transition: all 0.3s;
    }
    .back-to-orders:hover{
        color: #7e8230;;
    }

    .point-in-form{
        flex-wrap: wrap;
        margin-bottom: 38px;
        display: flex;
        gap:20px;

    }
    .title-style{
        width: 340px;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 20px;
        line-height: 140%;
        color: #2a2a28;
        margin-bottom: 5px;
    }
    .order-data{
        margin-top: 40px;
    }

    .mult-select-tag .rounded  {
        border: 1px solid #a5a5a5 !important;
        border-radius: 15px !important;
        box-sizing: border-box;
        width: 340px;
        height: 45px;
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);
        background: #fff;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 18px;
        line-height: 140%;
        color: #2a2a28;
    }
    .mult-select-tag .shadow {
        box-shadow: unset !important;
    }
    .mult-select-tag .drawer {
        height: 200px;
        top: 110% !important;
    }
    .mult-select-tag .drawer ul li input{
        height: unset;
        width: unset;
    }
    .mult-select-tag .drawer ul li{
        margin-bottom: 5px;
    }
    .item-container, .item-label{
        border: unset !important;
        border-color: unset !important;
        background: #e6e6e6 !important;
        font-family: "Inter", sans-serif !important;
        font-weight: 300 !important;
        font-size: 18px !important;
        color: #2a2a28 !important;
    }
    .duration-date{
        font-family: "Inter", sans-serif;
        font-style: italic;
        font-weight: 300;
        font-size: 16px;
        line-height: 140%;
        color: #7e8230;
    }
    .pay-info{
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 24px;
        color: #222;
    }
    .mult-select-tag button {
        color: #2a2a28 !important;
        font-weight: 700 !important;
    }
    .order-data{
        display: flex;
        gap: 20px;
    }
    .right-section{
        height: 1100px;
        padding: 20px;
        width: 25%;
        border-radius: 20px;
        background: white;
    }
    textarea{
        /*overflow: hidden;*/
        resize: none;
    }
    .photo-avatar{
        align-items: end;
        background-size: cover;
        background-position: center;
        display: flex;
        justify-content: center;
    }
    .circle-bg{
        fill: white;
        transition: all 0.3s;
    }
    .logout-button:hover .circle-bg{
        fill: #2a2a28;
    }
    .logout-button:hover svg path{
        stroke: white;
    }






</style>
<link rel="icon" type="image/svg+xml" href="{% static 'logo.svg' %}">

<title>Редактирование заказа - {{ order.number }}</title>

<div class="header">
    <div class="header-container">
        <a class="logo">
            <img src="{% static 'logo.svg' %}" alt="Logo">
        </a>
        <div class="navbar">
            <ul class="menu__box">
                <li><a href="{% url 'main' %}">Дашборд</a></li>
<!--                <li><a href="{% url 'calendar' %}">Календарь</a></li>-->
                <li><a class="active" style="color: white" href="{% url 'orders' %}">Заказы</a></li>
                <li><a href="{% url 'active'%}">Активность</a></li>
                <li><a href="{% url 'staff' %}">Сотрудники</a></li>
            </ul>
        </div>
        <div class="nav-tools">
            <a class="logout-button" style="cursor: pointer" href="{% url 'logout' %}">
                <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle class="circle-bg" cx="25" cy="25" r="25"  />
                  <path d="M29.6247 17.1677H19.208V31.751C19.208 32.3036 19.4275 32.8335 19.8182 33.2242C20.2089 33.6149 20.7388 33.8344 21.2913 33.8344H29.6247M30.6663 28.626L33.7913 25.501M33.7913 25.501L30.6663 22.376M33.7913 25.501H23.3747" stroke="black" stroke-width="1.04167" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </a>
            <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle  cx="25" cy="25" r="25" fill="white"/>
              <path d="M24.6116 35C24.1272 35 23.7138 34.8278 23.3715 34.4833C23.0292 34.1395 22.858 33.7261 22.858 33.2431H26.3718C26.3718 33.729 26.1995 34.1431 25.855 34.4855C25.5098 34.8285 25.0954 35 24.6116 35ZM17 32.1542V31.0664H18.7569V22.4474C18.7569 21.0259 19.2065 19.776 20.1058 18.6976C21.0065 17.6192 22.1469 16.9472 23.5271 16.6818V16.0878C23.5271 15.7854 23.6326 15.5287 23.8436 15.3177C24.0547 15.1059 24.311 15 24.6127 15C24.9137 15 25.1708 15.1059 25.384 15.3177C25.5965 15.5287 25.7027 15.7854 25.7027 16.0878V16.1694C25.5454 16.4146 25.4076 16.6622 25.2894 16.9124C25.1704 17.1619 25.078 17.4273 25.012 17.7087L24.8183 17.687C24.7552 17.6812 24.6874 17.6783 24.6149 17.6783C23.2928 17.6783 22.1673 18.1424 21.2382 19.0707C20.3099 19.9997 19.8458 21.1253 19.8458 22.4474V31.0664H29.3851V24.4534C29.5577 24.4874 29.7354 24.5139 29.9181 24.5328C30.1023 24.5509 30.2873 24.5531 30.4729 24.5393V31.0664H32.2298V32.1542H17Z" fill="#2A2A28" />
              <path d="M28.0872 21.1735C28.6181 21.7022 29.2606 21.9666 30.0149 21.9666C30.7706 21.9666 31.4113 21.7008 31.9393 21.1713C32.468 20.6412 32.7323 19.999 32.7323 19.2448C32.7309 18.4891 32.4654 17.8473 31.936 17.3193C31.4066 16.7913 30.7648 16.5273 30.0105 16.5273C29.2556 16.5273 28.6137 16.7924 28.085 17.3226C27.5571 17.8527 27.2931 18.4949 27.2931 19.2491C27.2931 20.0041 27.5578 20.6456 28.0872 21.1735Z" fill="#FF0035" />
            </svg>

            <div class="photo-profile">
                {% if request.user.employee.avatar %}
                    <img src="{{ request.user.employee.avatar.url }}" alt="Аватар" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                {% else %}
                    <img src="{% static 'default_avatar.jpg' %}" alt="Аватар" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="order-create">
    <a class="back-to-orders" href="{% url 'orders' %}">Назад ко всем заказам</a>
    <form id="orderCreationForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div style="justify-content: space-between; display: flex">
            <!-- ФИО сотрудника как поле ввода -->
            <input type="text" name="number" class="order-name" placeholder="Введите НОМЕР заказа" value="{{ order.number }}" required style="border-radius: 5px">
            <div class="employee-management">
                <!-- Иконки управления, если нужны -->
            </div>
        </div>
        <div class="order-data">
            <div class="left-section">
                <div class="point-in-form">
                    <label class="title-style">Менеджер<br>
                        <select name="manager" required>
                            {% for manager in managers %}
                            <option value="{{ manager.id }}" {% if manager.id == order.manager.id %}selected{% endif %}>
                                {{ manager.first_name }} {{ manager.last_name }}
                            </option>
                            {% endfor %}
                        </select>
                    </label>

                    <label class="title-style" style="width: 700px">Исполнители<br>
                      <select id="multiple-select" multiple>
                        {% for executor in executors %}
                        <option value="{{ executor.id }}">{{ executor.first_name }} {{ executor.last_name }}</option>
                        {% endfor %}
                      </select>
                    </label>
                    <input type="hidden" name="executors" id="executors" value="">
                </div>
                <div class="point-in-form">
                    <label class="title-style">Источник<br>
                        <select name="source" required>
                            <option value="site" {% if order.source == 'site' %}selected{% endif %}>Сайт</option>
                            <option value="recommendation" {% if order.source == 'recommendation' %}selected{% endif %}>Рекомендация</option>
                            <option value="returning_customer" {% if order.source == 'returning_customer' %}selected{% endif %}>Повторный клиент</option>
                        </select>
                    </label>
                    <label class="title-style">Номер договора<br>
                        <input type="text" name="contract_num" value="{{contract.num}}" required>
                    </label>
                    <div style="width: auto;">
                        <div style="width: auto; display: flex; gap: 20px;">
                            <label class="title-style" style="width: 220px">Дата заключения<br>
                                <input type="date" name="create_date" id="create_date" value="{{contract.create_date|date:'Y-m-d'}}" style="width: 100%" required>
                            </label>
                            <label class="title-style" style="width: 220px">Дата сдачи<br>
                                <input type="date" name="completion_date" id="completion_date" value="{{contract.completion_date|date:'Y-m-d'}}"style="width: 100%" required>
                            </label>
                        </div>
                        <div class="duration-date">
                            Срок выполнения по договору составляет <span id="contract_duration">{{contract.duration}}</span> дней
                        </div>

                    </div>
                </div>

                <div class="pay-info">Платежная информация</div>
                <div style="display:flex; gap: 20px; flex-wrap: wrap; ">
                    <div class="point-in-form" style="margin-bottom: unset; display: block; border-radius: 20px; width: 360px; height: 216px; background: #fff; margin-top: 21px">
                        <label class="title-style" style="display: block; margin-bottom: 17px; margin-left: auto; margin-right: auto; padding-top: 26px">
                            Общая стоимость по договору
                           <input type="number" name="total_value" id="total_value" value="{{ contract.total_value|floatformat:'0' }}" required>
                        </label>
                        <label class="title-style" style="display: block; margin-left: auto; margin-right: auto">
                            Способ оплаты<br>
                            <select name="payment_type" required>
                                <option value="cash" {% if contract.payment_type == "cash" %}selected{% endif %}>Наличные</option>
                                <option value="card" {% if contract.payment_type == "card" %}selected{% endif %}>По карте</option>
                                <option value="transaction" {% if contract.payment_type == "transaction" %}selected{% endif %}>Переводом</option>
                            </select>
                        </label>
                    </div>
                    <div class="point-in-form" style="margin-bottom: unset; margin-top: 47px; display: block;">
                        <div style="display: flex; gap: 20px">
                            <label class="title-style" style="width: 70px">Аванс<br>
                                <input type="number" name="prepayment_share" id="prepayment_share" value="{{ contract.prepayment_share|floatformat:'0' }}" style="width: 100%" required>
                            </label>
                            <label class="title-style">
                                <input type="number" name="prepayment_value" id="prepayment_value" style="margin-top: 28px" required>
                            </label>
                            <label class="title-style" style=" align-items: center; display: flex; height: 20px; margin-top: 40px; width: unset">
                                <input type="checkbox" name="is_prepayment_paid" style="width: unset; height: unset" value="true" {% if contract.is_prepayment_paid %}checked{% endif %}> Оплачен
                            </label>
                        </div>
                        <div style="margin-top: 12px">
                            <label class="title-style" style="display: block;">Дата оплаты аванса
                                <input type="date" name="prepayment_date" id="prepayment_date" value="{{ contract.prepayment_date|date:"Y-m-d" }}" style="width: 160%">
                            </label>
                        </div>

                    </div>
                    <div class="point-in-form" style="margin-bottom: unset; margin-top: 47px; display: block">
                        <div style="display: flex; gap: 20px">
                             <label class="title-style">Остаток<br>
                                <input type="number" name="postpayment_value" id="postpayment_value" required>
                            </label>
                            <label class="title-style" style=" align-items: center; display: flex; height: 20px; margin-top: 40px; width: unset">
                                <input type="checkbox" name="is_postpayment_paid" style="width: unset; height: unset" value="true" {% if contract.is_postpayment_paid %}checked{% endif %}> Оплачен
                            </label>
                        </div>
                        <div style="margin-top: 12px">
                             <label class="title-style" style="display: block;">Дата оплаты остатка
                                <input type="date" name="postpayment_date" id="postpayment_date" value="{{ contract.postpayment_date|date:"Y-m-d" }}" style="width: 130%">
                            </label>
                        </div>

                    </div>
                </div>


                <div class="pay-info" style="margin-top: 40px;">Информация о заказчике</div>
                <div style="display: flex; border-radius: 20px; background: #fff; padding: 20px; width: 1060px; margin-top: 10px;">
                    <div class="point-in-form" style="margin-bottom: unset">
                        <label class="title-style">Адрес заказчика<br>
                            <input type="text" name="address" id="address" value="{{ client.address }}" required>
                        </label>
                        <label class="title-style">Контактный телефон<br>
                            <input type="text" name="contact_number" id="contact_number" value="{{ client.contact_number }}" required>
                        </label>
                        <label class="title-style">ФИО<br>
                            <input type="text" name="full_name" id="client_full_name" value="{{ client.first_name }} {{ client.last_name }} {{ client.middle_name }}" required>
                        </label>
                        <label class="title-style" style="width: 100%">Комментарии к заказчику<br>
                            <input style="width: 100%" type="text" name="comments" id="comments" value="{{ client.comments }}" required>
                        </label>
                    </div>
                </div>


                <div class="pay-info" style="margin-top: 40px">Объект работы</div>
                <div style="display: flex; border-radius: 20px; background: #fff; padding: 20px; width: 1060px; margin-top: 10px;">
                    <div class="point-in-form" style="margin-bottom: unset">
                        <label class="title-style">Тип мебели<br>
                            <select name="furniture_type1" required>
                                <option value="soft" {% if technical_specification.furniture_type1 == "soft" %}selected{% endif %}>Мягкая мебель</option>
                                <option value="cabinet" {% if technical_specification.furniture_type1 == "cabinet" %}selected{% endif %}>Корпусная мебель</option>
                            </select>
                        </label>
                        <label class="title-style" id="type_work">Тип работы<br>
                            <select id="work_type1" multiple>
                                <option value="create">Изготовление</option>
                                <option value="reupholster">Перетяжка</option>
                                <option value="restoration">Реставрация</option>
                                <option value="new_build">Новодел</option>
                            </select>
                        </label>
                        <input type="hidden" name="work_types" id="work_types" value="">

                        <label class="title-style" style="width: 140px">Тип изделия<br>
                            <input style="width: 100%" type="text" name="item_type" id="item_type" value="{{ technical_specification.item_type }}" required>
                        </label>
                        <label class="title-style" style="width: 170px">Кол-во изделий<br>
                            <input style="width: 100%" type="number" name="items_qty" id="items_qty" value="{{ technical_specification.items_qty }}" required>
                        </label>
                        <label class="title-style" style="width: 100%">Краткое описание<br>
                            <input style="width: 100%" type="text" name="short_descr" id="short_descr" value="{{ technical_specification.short_descr }}" required>
                        </label>

                    </div>
                </div>


                <div class="pay-info" style="margin-top: 40px">Материалы</div>
                {% with material=materials.first %}
                <div style="display: flex; width: 1060px; margin-top: 10px; gap: 22px">
                    <div class="point-in-form" style="margin-bottom: unset; display: block; border-radius: 20px; padding: 20px; background: #fff;">
                        <div style="display: flex; gap: 10px;">
                            <label class="title-style" style="width: 450px">Наименование<br>
                                <input type="text" name="material_name" id="material_name" value="{{ material.name }}" style="width: 450px" required>
                            </label>
                            <label class="title-style" style="margin-top: 40px; width: unset">
                                <input type="checkbox" name="stock" style="width: unset; height: unset" value="true" {% if material.in_stock %}checked{% endif %}> В цеху
                            </label>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px">
                            <label class="title-style" style="width: 450px">Фурнитура (при необходимости)<br>
                                <input type="text" name="fitting_name" id="fitting_name" value="{{ material.fitting_name }}" style="width: 450px" required>
                            </label>
                            <label class="title-style" style="margin-top: 40px; width: unset">
                                <input type="checkbox" name="fitting_in_stock" style="width: unset; height: unset" value="true" {% if material.fitting_in_stock %}checked{% endif %}> В цеху
                            </label>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px">
                            <label class="title-style" style="width: 100%">Комментарии<br>
                                <input type="text" name="material_comments" id="material_comments" value="{{ material.comments }}" style="width: 100%" required>
                            </label>
                        </div>

                    </div>
                    <div style="padding-top: 20px; width: 42%">
                         <label class="title-style" style="width: 100%;">Стоимость<br>
                             <input type="number" name="material_cost" id="material_cost" value="{{ material.cost|floatformat:'0' }}" style="width: 100%;" required>
                        </label>
                        <div style="display: flex; width: 100%; gap: 20px; margin-top: 20px">
                            <label class="title-style" style="width: 50%">Статус заказа<br>
                                <select name="material_order_status" style="width: 100%" >
                                    <option value="not_ordered" {% if material.order_status == "not_ordered" %}selected{% endif %}>Не заказан</option>
                                    <option value="ordered" {% if material.order_status == "ordered" %}selected{% endif %}>Заказан</option>
                                </select>
                            </label>
                            <label class="title-style" style="width: 50%">Дата заказа<br>
                                <input type="date" name="material_order_date" id="material_order_date" value="{{ material.order_date|date:'Y-m-d' }}" style="width: 100%" >
                            </label>
                        </div>
                        <div style="display: flex; width: 100%; gap: 20px; margin-top: 20px">
                            <label class="title-style" style="width: 50%">Статус оплаты<br>
                                <select name="material_payment_status" style="width: 100%" >
                                    <option value="paid" {% if material.payment_status == "paid" %}selected{% endif %}>Оплачено</option>
                                    <option value="unpaid" {% if material.payment_status == "unpaid" %}selected{% endif %}>Не оплачено</option>
                                    <option value="partial" {% if material.payment_status == "partial" %}selected{% endif %}>Частично оплачено</option>
                                </select>
                            </label>
                            <label class="title-style" style="width: 50%">Дата оплаты<br>
                                <input type="date" name="material_payment_date" id="material_payment_date" value="{{ material.payment_date|date:'Y-m-d' }}" style="width: 100%" >
                            </label>
                        </div>
                    </div>
                </div>
                {% endwith %}





                <div style="width: 100%; display: flex; gap: 20px">

                    <div style="width: 50%">

                        <div class="pay-info" style="margin-top: 40px">Забор</div>
                        <div class="point-in-form" style="margin-bottom: unset; display: block; border-radius: 20px; padding: 20px; background: #fff;">
                            <div style="display: flex">
                                <label class="title-style" style="width: unset">
                                    Мебель в цеху? <input type="checkbox" name="pickupdelivery_is_picked" style="width: unset; height: unset" value="true" {% if pickup.is_picked %}checked{% endif %}>
                                </label>
                            </div>
                            <div style="display: flex; margin-top: 30px; gap: 20px">
                                <label class="title-style" style="width: 40%">Дата забора<br>
                                     <input type="date" name="pickupdelivery_pickup_date" id="pickupdelivery_pickup_date" style="width: 100%" value="{{ pickup.pickup_date|date:'Y-m-d' }}" >
                                </label>
                                <label class="title-style" style="width: 20%">Время<br>
                                     <input type="time" name="pickupdelivery_pickup_time" id="pickupdelivery_pickup_time" style="width: 100%" value="{{ pickup.pickup_time|time:'H:i' }}" >
                                </label>
                                <label class="title-style" style="width: 40%">Способ забора<br>
                                     <select name="pickupdelivery_pickup_type" style="width: 100%" >
                                        <option value="self_delivery" {% if pickup.pickup_type == "self_delivery" %}selected{% endif %}>Клиент привозит сам</option>
                                        <option value="pickup" {% if pickup.pickup_type == "pickup" %}selected{% endif %}>Забирает курьер</option>
                                    </select>
                                </label>
                            </div>
                            <div style="display: flex; margin-top: 30px; gap: 20px">
                                <label class="title-style" style="width: 100%">Ответственный за забор<br>
                                    <select id="pickup_guy" name="pickup_guy" style="width: 100%">
                                        {% for executor in executors %}
                                        <option value="{{ executor.id }}" {% if pickup and pickup.pickup_guy_id == executor.id %}selected{% endif %}>{{ executor.first_name }} {{ executor.last_name }}</option>
                                        {% endfor %}
                                    </select>
                                </label>
                            </div>
                            <div style="display: flex; margin-top: 30px; gap: 20px">
                                <label class="title-style" style="width: 100%">Комментарии к забору<br>
                                    <input type="text" name="pickupdelivery_pickup_comments" id="pickupdelivery_pickup_comments" value="{{ pickup.pickup_comments }}" style="width: 100%">
                                </label>
                            </div>

                        </div>

                    </div>

                    <div style="width: 50%">
                        <div class="pay-info" style="margin-top: 40px">Доставка</div>
                        <div class="point-in-form" style="margin-bottom: unset; display: block; border-radius: 20px; padding: 20px; background: #fff;">
                            <div style="display: flex">
                                <label class="title-style" style="width: unset">
                                    Мебель доставили заказчику? <input type="checkbox" name="pickupdelivery_is_delivered" style="width: unset; height: unset" value="true" {% if pickup.is_delivered %}checked{% endif %}>
                                </label>
                            </div>
                            <div style="display: flex; margin-top: 30px; gap: 20px">
                                <label class="title-style" style="width: 40%">Дата доставки<br>
                                     <input type="date" name="pickupdelivery_delivery_date" id="pickupdelivery_delivery_date" style="width: 100%" value="{{ pickup.delivery_date|date:'Y-m-d' }}" >
                                </label>
                                <label class="title-style" style="width: 20%">Время<br>
                                     <input type="time" name="pickupdelivery_delivery_time" id="pickupdelivery_delivery_time" style="width: 100%" value="{{ pickup.delivery_time|time:'H:i' }}" >
                                </label>
                                <label class="title-style" style="width: 40%">Способ доставки<br>
                                     <select name="pickupdelivery_delivery_type" style="width: 100%" >
                                        <option value="self_delivery" {% if pickup.delivery_type == "self_delivery" %}selected{% endif %}>Самовывоз клиентом</option>
                                        <option value="delivery" {% if pickup.delivery_type == "delivery" %}selected{% endif %}>Доставляет курьер</option>
                                    </select>
                                </label>
                            </div>
                            <div style="display: flex; margin-top: 30px; gap: 20px">
                                <label class="title-style" style="width: 100%">Ответственный за доставку<br>
                                     <select id="delivery_guy" name="delivery_guy" style="width: 100%">
                                        {% for executor in executors %}
                                        <option value="{{ executor.id }}" {% if pickup.delivery_guy and pickup.delivery_guy.id == executor.id %}selected{% endif %}>{{ executor.first_name }} {{ executor.last_name }}</option>
                                        {% endfor %}
                                    </select>
                                </label>
                            </div>
                            <div style="display: flex; margin-top: 30px; gap: 20px">
                                <label class="title-style" style="width: 100%">Комментарии к доставке<br>
                                    <input type="text" name="pickupdelivery_delivery_comments" id="pickupdelivery_delivery_comments" style="width: 100%" value="{{ pickup.delivery_comments }}">
                                </label>
                            </div>

                        </div>

                    </div>

                </div>





                <button class="submit-button" type="submit" style="margin-top: 20px;margin-right: 50%;margin-left: 50%;">Сохранить изменения</button>
            </div>
            <div class="right-section">
                <div>
                   <label class="title-style" style="width: 100%">Техзадание<br>
                       <textarea style="width: 100%; height:400px; border: unset" name="full_descr" placeholder="Введите полное ТЗ">{{technical_specification.full_descr}}</textarea>
                   </label>
                </div>
                <div style="margin-top: 60px">
                    <label class="title-style" style="width: 100%; margin-top: 60px">Фотографии<br>
                        <div style="display: flex; flex-wrap: wrap; gap: 15px">
                            <div class="photo-avatar" style="width: 200px; height: 200px; background-image: url('{% if technical_specification.photo1 %}{{ technical_specification.photo1.url }}{% endif %}')" id="photoPreview1">
                                <label for="photoInput1" class="upload-label" style="cursor: pointer; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                                    <input type="file" id="photoInput1" name="photo1" accept="image/*" style="display: none;">
                                </label>
                            </div>
                            <div class="photo-avatar" style="width: 200px; height: 200px; background-image: url('{% if technical_specification.photo1 %}{{ technical_specification.photo2.url }}{% endif %}')" id="photoPreview2">
                                <label for="photoInput2" class="upload-label" style="cursor: pointer; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                                    <input type="file" id="photoInput2" name="photo2" accept="image/*" style="display: none;">
                                </label>
                            </div>
                            <div class="photo-avatar" style="width: 200px; height: 200px; background-image: url('{% if technical_specification.photo1 %}{{ technical_specification.photo3.url }}{% endif %}')" id="photoPreview3">
                                <label for="photoInput3" class="upload-label" style="cursor: pointer; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                                    <input type="file" id="photoInput3" name="photo3" accept="image/*" style="display: none;">
                                </label>
                            </div>
                            <div class="photo-avatar" style="width: 200px; height: 200px; background-image: url('{% if technical_specification.photo1 %}{{ technical_specification.photo4.url }}{% endif %}')" id="photoPreview4">
                                <label for="photoInput4" class="upload-label" style="cursor: pointer; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
                                    <input type="file" id="photoInput4" name="photo4" accept="image/*" style="display: none;">
                                </label>
                            </div>
                        </div>



                    </label>
                </div>

                <div style="margin-top: 60px">
                    <label class="title-style" style="width: 100%; margin-top: 60px">Комментарии<br>
                         <input style="width: 100%; border: unset" placeholder="Введите комментарий к ТЗ" name="technicalspecification_comments" value="{{technical_specification.comments}}">
                    </label>
                </div>


            </div>
        </div>
    </form>
</div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@3.0.1/dist/css/multi-select-tag.css">
<script src="https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@3.0.1/dist/js/multi-select-tag.js"></script>




<script>
document.addEventListener('DOMContentLoaded', function() {
    // Извлечение выбранных типов работ из модели и инициализация массива
    var selectedWorkTypes = [
        '{{ technical_specification.work_type1 }}',
        '{{ technical_specification.work_type2 }}'
    ].filter(function(type) {
        // Фильтруем, исключая пустые строки и строку "None"
        return type && type !== 'None';
    });
    // Словарь для отображения названий
    var workTypeNames = {
        'create': 'Изготовление',
        'reupholster': 'Перетяжка',
        'restoration': 'Реставрация',
        'new_build': 'Новодел'
    };

    // Получаем контейнер для добавления выбранных типов работ
    var inputContainer = document.querySelector('#type_work .input-container');
    var workTypesInput = document.getElementById('work_types');

    // Перебор только выбранных типов работ
    selectedWorkTypes.forEach(function(workTypeValue) {
        var itemContainer = document.createElement('div');
        itemContainer.className = 'item-container';
        itemContainer.style.color = 'rgb(3, 114, 178)';
        itemContainer.style.borderColor = 'rgb(3, 114, 178)';
        itemContainer.style.background = 'rgb(192, 230, 252)';

        var itemLabel = document.createElement('div');
        itemLabel.className = 'item-label';
        itemLabel.setAttribute('data-value', workTypeValue);
        itemLabel.style.color = 'rgb(3, 114, 178)';
        itemLabel.textContent = workTypeNames[workTypeValue];

        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', '100%');
        svg.setAttribute('height', '100%');
        svg.setAttribute('fill', 'none');
        svg.setAttribute('viewBox', '0 0 24 24');
        svg.setAttribute('stroke', 'currentColor');
        svg.setAttribute('stroke-width', '2');
        svg.setAttribute('stroke-linecap', 'round');
        svg.setAttribute('stroke-linejoin', 'round');
        svg.classList.add('item-close-svg');

        var line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line1.setAttribute('x1', '18');
        line1.setAttribute('y1', '6');
        line1.setAttribute('x2', '6');
        line1.setAttribute('y2', '18');
        svg.appendChild(line1);

        var line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line2.setAttribute('x1', '6');
        line2.setAttribute('y1', '6');
        line2.setAttribute('x2', '18');
        line2.setAttribute('y2', '18');
        svg.appendChild(line2);

        itemContainer.appendChild(itemLabel);
        itemContainer.appendChild(svg);
        inputContainer.appendChild(itemContainer);
    });

    // Обновление значения скрытого поля с выбранными типами работ
    workTypesInput.value = selectedWorkTypes.join(',');
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var executors = [
        {% for executor in executors_list %}
        { id: {{ executor.id }}, name: '{{ executor.first_name }} {{ executor.last_name }}' }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];

    var inputContainer = document.querySelector('.input-container');
    var executorsInput = document.getElementById('executors');  // Получаем ссылку на скрытое поле
    var executorIds = [];  // Создаем массив для хранения ID исполнителей

    executors.forEach(function(executor) {
        var itemContainer = document.createElement('div');
        itemContainer.className = 'item-container';
        itemContainer.style.color = 'rgb(3, 114, 178)';
        itemContainer.style.borderColor = 'rgb(3, 114, 178)';
        itemContainer.style.background = 'rgb(192, 230, 252)';

        var itemLabel = document.createElement('div');
        itemLabel.className = 'item-label';
        itemLabel.setAttribute('data-value', executor.id);
        itemLabel.style.color = 'rgb(3, 114, 178)';
        itemLabel.textContent = executor.name;

        var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', '100%');
        svg.setAttribute('height', '100%');
        svg.setAttribute('fill', 'none');
        svg.setAttribute('viewBox', '0 0 24 24');
        svg.setAttribute('stroke', 'currentColor');
        svg.setAttribute('stroke-width', '2');
        svg.setAttribute('stroke-linecap', 'round');
        svg.setAttribute('stroke-linejoin', 'round');
        svg.classList.add('item-close-svg');

        var line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line1.setAttribute('x1', '18');
        line1.setAttribute('y1', '6');
        line1.setAttribute('x2', '6');
        line1.setAttribute('y2', '18');
        svg.appendChild(line1);

        var line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line2.setAttribute('x1', '6');
        line2.setAttribute('y1', '6');
        line2.setAttribute('x2', '18');
        line2.setAttribute('y2', '18');
        svg.appendChild(line2);

        itemContainer.appendChild(itemLabel);
        itemContainer.appendChild(svg);
        inputContainer.appendChild(itemContainer);

        // Добавляем ID исполнителя в массив
        executorIds.push(executor.id);
    });

    // Присваиваем значение скрытому полю
    executorsInput.value = executorIds.join(',');
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function updateValues() {
        var totalValue = parseFloat(document.getElementById('total_value').value) || 0;
        var prepaymentShare = parseFloat(document.getElementById('prepayment_share').value) || 0;

        // Расчет предоплаты как процент от общей суммы
        var prepaymentValue = (prepaymentShare / 100) * totalValue;
        document.getElementById('prepayment_value').value = prepaymentValue.toFixed(2);

        // Расчет остатка платежа
        var postpaymentValue = totalValue - prepaymentValue;
        document.getElementById('postpayment_value').value = postpaymentValue.toFixed(2);
    }

    // Подписка на события изменения значений для автоматического пересчета
    document.getElementById('total_value').addEventListener('input', updateValues);
    document.getElementById('prepayment_share').addEventListener('input', updateValues);

    // Инициализация расчетов при загрузке
    updateValues();
});
</script>

<script>
    new MultiSelectTag('work_type1', {
    rounded: true,    // default true
    shadow: true,      // default false
    placeholder: 'Поиск',  // default Search...
    tagColor: {
        textColor: '#327b2c',
        borderColor: '#92e681',
        bgColor: '#eaffe6',
    },
    onChange: function(values) {
        // Получаем все значения `value` из объектов values и преобразуем их в массив ID
        var ids = values.map(function(item) {
            return item.value;
        });
        // Преобразуем массив в строку, разделенную запятыми
        document.getElementById('work_types').value = ids.join(',');
    }
})
</script>

<script>
    new MultiSelectTag('multiple-select', {
    rounded: true,    // default true
    shadow: true,      // default false
    placeholder: 'Поиск',  // default Search...
    tagColor: {
        textColor: '#327b2c',
        borderColor: '#92e681',
        bgColor: '#eaffe6',
    },
    onChange: function(values) {
        // Получаем все значения `value` из объектов values и преобразуем их в массив ID
        var ids = values.map(function(item) {
            return item.value;
        });
        // Преобразуем массив в строку, разделенную запятыми
        document.getElementById('executors').value = ids.join(',');
    }
})
</script>

<script>
document.addEventListener('keydown', function(event) {
    if (event.key === "Escape") { // Проверка нажатия на клавишу "Esc"
        window.location.href = "{% url 'orders' %}"; // Перенаправление на страницу сотрудников
    }
});
</script>

<script>
    // Add JavaScript to calculate the difference in days
    document.getElementById('completion_date').addEventListener('change', function() {
        const startDate = new Date(document.getElementById('create_date').value);
        const endDate = new Date(this.value);
        const diffTime = Math.abs(endDate - startDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        document.getElementById('contract_duration').textContent = diffDays;
    });
</script>

<script>
document.getElementById('photoInput1').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photoPreview1');
            preview.style.backgroundImage = `url('${e.target.result}')`;
            preview.style.backgroundSize = 'cover';
            preview.style.backgroundPosition = 'center';
        };
        reader.readAsDataURL(file);
    }
});
document.getElementById('photoInput2').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photoPreview2');
            preview.style.backgroundImage = `url('${e.target.result}')`;
            preview.style.backgroundSize = 'cover';
            preview.style.backgroundPosition = 'center';
        };
        reader.readAsDataURL(file);
    }
});
document.getElementById('photoInput3').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photoPreview3');
            preview.style.backgroundImage = `url('${e.target.result}')`;
            preview.style.backgroundSize = 'cover';
            preview.style.backgroundPosition = 'center';
        };
        reader.readAsDataURL(file);
    }
});
document.getElementById('photoInput4').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photoPreview4');
            preview.style.backgroundImage = `url('${e.target.result}')`;
            preview.style.backgroundSize = 'cover';
            preview.style.backgroundPosition = 'center';
        };
        reader.readAsDataURL(file);
    }
});
</script>

{% endblock %}