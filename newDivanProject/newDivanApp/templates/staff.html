{% load static %}
{% load humanize %}
{% block content %}

<style>
    body{

        background: #f4f4f4;
        padding: 0;
        margin: 0;
        zoom: 80%;
        overflow-x: hidden;
    }
    .header {
        display: flex;
        align-items: center;
        width: 100%;
        height: 140px;
        background-color: #f4f4f4;
        position: fixed; /* Закрепляем заголовок */
        top: 0; /* Располагаем заголовок в верхней части экрана */
        left: 0; /* Выравниваем заголовок по левому краю */
        z-index: 1000; /* Устанавливаем z-index для того, чтобы заголовок был поверх других элементов */
    }
    .header-container{
        justify-content: space-between;
        margin: auto;
        display: flex;
        width: calc(100% - 141px);
        height: 60px;
    }
    .logo{
        height: 60px;
        width: 60px;
    }

    .navbar{
        margin-bottom:auto;
        margin-top: auto;
        height: 39px;
        width: auto;
        display: inline-flex;
        justify-content: flex-end;
        align-items: center;
        gap: 20px;
    }
    ul{
        gap: 20px;
        margin: 0;
        width: 100%;
        height: 100%;
        display: flex;
        list-style-type: none;
    }

    ul li{
        width: 135px;

    }
    a{
        text-decoration: none;
        color: white;
    }
    .navbar a, .about-us-link a{
        color: var(--main-light-grey, #2a2a28);
        text-decoration: none;
    }
    .navbar a:hover, .about-us-link a:hover{
        cursor: pointer;
        color: var(--main-grey, #232323);
        transition: 0.5s;
    }
     /* Стили для остальных пунктов меню */
    .navbar a {
        color: var(--main-light-grey, #2a2a28);
        display: block;
        text-align: center;
        padding: 10px 15px; /* Одинаковые отступы для всех пунктов */
        border-radius: 80px; /* Скругление углов для всех пунктов */
        font-family: "Inter", sans-serif;
        font-size: 18px;

    }

    /* Стили при наведении для всех пунктов меню */
    .navbar a:hover {
        background-color: #2a2a28;; /* Фон для активного пункта меню */
        color: var(--main-grey, #ffffff); /* Фон при наведении */
        text-decoration: none;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 18px;
        text-align: center;
    }
    .navbar .active a {
        background-color: #2a2a28;; /* Фон для активного пункта меню */
        color: var(--main-grey, #ffffff); /* Цвет текста для активного пункта */

    }
    .active{
        font-weight: 700;
        background-color: #2a2a28;; /* Фон для активного пункта меню */
        color: var(--main-grey, #ffffff); /* Цвет текста для активного пункта */
    }

    .nav-tools{
        display: flex;
        justify-content: space-between;
        width: 170px;
        height: 50px;
    }
    .photo-profile{
        border-radius: 100%;
        height: 50px;
        width: 50px;
        background: white;
    }
    .title-page{
        margin-top: 140px;
        margin-left: 70px;
        display: flex;
    }
    .title-page-base{
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 48px;
        line-height: 100%;
        color: #2a2a28;
    }
    .count-orders{
        margin-left: 7px;
        margin-top: 10px;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 20px;
        line-height: 100%;
        color: #7e8230;
    }
    .sorting-block{
        margin-top: 40px;
        width: 100%;
    }
    .sorting-panel{
        display: flex;
        justify-content: space-between;
        height: 83px;
        margin-left: auto;
        margin-right: auto;
        width: calc(100% - 141px);
    }
    .sorting-label{
        gap: 20px;
        display: flex;
    }
    .panel-pt{
        margin-bottom: 5px;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 20px;
        line-height: 140%;
        color: #000;
    }
    .sorting-panel-pt input{
        border: 1px solid #a5a5a5;
        border-radius: 15px;
        width: 460px;
        height: 50px;
        backdrop-filter: blur(50px);
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);
        background: #fff;
        font-family: "Inter", sans-serif;
        font-weight: 200;
        font-size: 18px;
        line-height: 140%;
        color: #a5a5a5;
    }
    .sorting-panel-pt select{
        padding: 0 14px;
        border: 1px solid #a5a5a5;
        border-radius: 15px;
        min-width: 220px;
        height: 50px;
        backdrop-filter: blur(50px);
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);
        background: #fff;
        font-family: "Inter", sans-serif;
        font-weight: 600;
        font-size: 18px;
        line-height: 140%;
        color: #2a2a28;
    }
    input .calendar{
        border: 1px solid #a5a5a5;
        border-radius: 15px;
        width: 340px;
        height: 50px;
        backdrop-filter: blur(50px);
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);
        background: #fff;
    }
    input[type="text"] {
        color: #000000;
        font-weight: 500;
        padding: 8px 12px 8px 60px; /* Отступы для текста, больше слева для иконки */
        border: 1px solid #ccc; /* Граница поля */
        border-radius: 15px; /* Скругленные углы */
        background-color: white; /* Фоновый цвет */
        background-image: url('data:image/svg+xml;utf8,<svg width="28" height="29" viewBox="0 0 28 29" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.91558 20.528C7.14914 20.528 4.80493 19.5333 2.88296 17.544C0.960987 15.5547 0 13.1283 0 10.2649C0 7.4015 0.960987 4.97513 2.88296 2.98579C4.80493 0.996459 7.14914 0.00119408 9.91558 0C12.6832 0 15.028 0.995265 16.9499 2.98579C18.8719 4.97513 19.8329 7.4015 19.8329 10.2649C19.8329 11.5091 19.6201 12.7134 19.1944 13.8776C18.7675 15.0418 18.208 16.0377 17.5158 16.8652L27.7394 27.4453C27.9009 27.6125 27.9874 27.8185 27.999 28.0632C28.0105 28.3056 27.924 28.5224 27.7394 28.7134C27.5548 28.9045 27.3512 29 27.1286 29C26.9036 29 26.6994 28.9045 26.516 28.7134L16.2924 18.1315C15.4271 18.8945 14.4321 19.485 13.3073 19.9029C12.1825 20.3208 11.0519 20.5298 9.91558 20.5298M9.91558 18.7387C12.2113 18.7387 14.15 17.9207 15.7317 16.2849C17.3122 14.649 18.1024 12.6423 18.1024 10.2649C18.1024 7.88868 17.3122 5.88263 15.7317 4.24674C14.1512 2.61085 12.2131 1.79291 9.91731 1.79291C7.62156 1.79291 5.68286 2.61085 4.10121 4.24674C2.52072 5.88263 1.73047 7.88868 1.73047 10.2649C1.73047 12.6411 2.52072 14.6472 4.10121 16.2831C5.6817 17.9189 7.61983 18.7369 9.91558 18.7369" fill="%23A5A5A5"/></svg>'); /* SVG иконка лупы */
        background-size: 29px 29px; /* Размер иконки */
        background-position: 10px center; /* Позиция иконки */
        background-repeat: no-repeat; /* Повторение иконки */
    }
    #dateRangePicker {
        font-family: "Inter", sans-serif;
        font-weight: 500;
        font-size: 20px;
        line-height: 100%;
        text-align: left;
        color: #2a2a28;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        width: 100%;
    }

    /* Стилизация календаря */
    .flatpickr-calendar {
        font-family: "Inter", sans-serif;
        font-size: 20px;
        color: #2a2a28;
    }

    .flatpickr-day {
        line-height: 38px; /* Увеличить размеры для удобства клика */
    }

    .flatpickr-month {
        color: #2a2a28;
        font-weight: 500;
    }

    .flatpickr-weekday {
        color: #2a2a28;
        font-weight: 500;
    }

    .flatpickr-current-month input {
        text-align: right;
        font-weight: 500;
    }
    .add-new-staff{
        align-self: flex-end;
    }
    .add-new-staff a{
        padding-left: 25px;
        padding-right: 25px;
        gap: 25px;
        cursor: pointer;
        border: none;
        border-radius: 15px;
        height: 50px;
        backdrop-filter: blur(50px);
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);
        background: #7e8230;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 20px;
        line-height: 140%;
        color: #fff;
    }

    .flatpickr-calendar .flatpickr-day.startRange,
    .flatpickr-calendar .flatpickr-day.endRange {
        background: #7e8230; /* Зеленый цвет фона для дней в диапазоне */
        color: #fff; /* Белый цвет текста для лучшей видимости */
    }

    /* Цвет фона для дней между начальной и конечной датами в диапазоне */
    .flatpickr-calendar .flatpickr-day.startRange + .endRange ~ .inRange,
    .flatpickr-calendar .flatpickr-day.startRange + .flatpickr-day.endRange,
    .flatpickr-calendar .flatpickr-day.startRange.inRange,
    .flatpickr-calendar .flatpickr-day.endRange.inRange {
        background: #7e8230; /* Светло-зеленый для дней между */
    }

    /* Стилизация границ начала и конца диапазона */
    .flatpickr-calendar .flatpickr-day.startRange,
    .flatpickr-calendar .flatpickr-day.endRange {
        border: 2px solid #7e8230; /* Темно-зеленые границы */
    }
        /* Цвет фона для дней при наведении */
    .flatpickr-calendar .flatpickr-day:hover {
        background: #7e8230; /* Темнее зеленый цвет при наведении */
        color: white; /* Белый цвет текста */
    }

    /* Цвет фона для дней в диапазоне при наведении */
    .flatpickr-calendar .flatpickr-day.inRange:hover,
    .flatpickr-calendar .flatpickr-day.startRange:hover,
    .flatpickr-calendar .flatpickr-day.endRange:hover {
        background: #7e8230; /* Еще более темный зеленый цвет для выбранных дней при наведении */
        color: white;
        border-color: #7e8230;
    }
    /* Цвет фона для выбранных дней в диапазоне */
    .flatpickr-calendar .flatpickr-day.selected,
    .flatpickr-calendar .flatpickr-day.startRange,
    .flatpickr-calendar .flatpickr-day.endRange,
    .flatpickr-calendar .flatpickr-day.selected.startRange,
    .flatpickr-calendar .flatpickr-day.selected.endRange,
    .flatpickr-calendar .flatpickr-day.selected.inRange,
    .flatpickr-calendar .flatpickr-day.startRange.endRange,
    .flatpickr-calendar .flatpickr-day:focus,
    .flatpickr-calendar .flatpickr-day:hover {
        background: #7e8230; /* Зеленый цвет фона */
        border-color: #7e8230;
        color: white; /* Белый цвет текста для лучшей видимости */
    }


        /* Стилизация кнопок месяца и года */
    .flatpickr-calendar .flatpickr-prev-month,
    .flatpickr-calendar .flatpickr-next-month {
        color: #7e8230; /* Зеленый цвет стрелок */
    }
    .flatpickr-calendar .flatpickr-month {
        border-bottom: 2px solid #7e8230; /* Зеленая граница под месяцем */
    }
    .employees-table{
        border-radius: 20px;
        background-color: #fff;
        margin-top: 40px;
        width: calc(100% - 141px);
        margin-right: auto;
        margin-left: auto;
        backdrop-filter: blur(50px);
        box-shadow: inset 0 0 20px -3px rgba(255, 255, 255, 0.1);

    }
    .employees-text{
        margin-top: 20px;
        font-family: "Inter", sans-serif;
        font-weight: 400;
        font-size: 32px;
        line-height: 100%;
        color: #2a2a28;
    }
    .sort-count-emp{
        margin-top: 25px;
        border-radius: 10px;
        padding: 0px 15px;
        height: 20px;
        background: #a5a5a5;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 16px;
        text-align: center;
        color: #fff;

    }
    table{
        margin-left: 20px;
        margin-top: 11px;
        width: calc(100% - 20px);
    }
    tr th{
        padding-left: 20px;
        margin: 0;
        height: 80px;
        font-family: "Inter", sans-serif;
        font-weight: 700;
        font-size: 20px;
        line-height: 140%;
        color: #2a2a28;
    }

    th, td {
        padding-left: 20px;
        height: 80px;
        font-family: "Inter", sans-serif;
        font-weight: 500;
        font-size: 18px;
        line-height: 140%;
        color: #2a2a28;
        text-align: left;
    }
    .avatars {
        display: flex;
        align-items: center;
        position: relative;
    }

    .avatar {
        width: 50px; /* Установите нужный размер */
        height: 50px; /* Установите нужный размер */
        border-radius: 50%; /* Делает изображения круглыми */
        border: 2px solid white; /* Белая граница для отделения изображений друг от друга */
        position: relative;
        right: 10px; /* Смещение каждого последующего аватара налево */
    }

    .avatar:first-child {
        right: 0;
    }
    .delete-employee-button, .refactor-employee-button{
        cursor: pointer;
        transition: all 0.3s;
        fill: #4E4E4E

    }
    .delete-employee-button:hover{
        fill: #ff0035;
    }
    .refactor-employee-button:hover{
        fill: #7e8230;
    }
    .add-new-staff a{
        transition: all 0.3s;
    }
    .add-new-staff a:hover{
        background: #2a2a28;
        border: none;
    }
    .working{
        width: 71px;
        border-radius: 15px;
        padding: 0px 15px;
        background: #e8eab9;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 16px;
        text-align: center;
        color: #7e8230;
    }
    .not_working{
        width: 55px;
        border-radius: 15px;
        padding: 0px 15px;
        background: #ffc2ce;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 16px;
        text-align: center;
        color: #ff0035;
    }
    .probation{
        width: 157px;
        border-radius: 15px;
        padding: 0px 15px;
        background: #ccc;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 16px;
        text-align: center;
        color: #2a2a28
    }
    .fixed{
        width: 50%;
        border-radius: 15px;
        padding: 0px 15px;
        background: #c3e1ff;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 16px;
        text-align: center;
        color: #3e78b2;
    }
    .not_fixed{
        width: 50%;
        border-radius: 15px;
        padding: 0px 15px;
        background: #c3e1ff;
        font-family: "Inter", sans-serif;
        font-weight: 300;
        font-size: 16px;
        text-align: center;
        color: #3e78b2;

    }


    @media (max-width: 1400px) {
        .button-text {
            display: none;
        }
        .add-new-staff button{
            width: 75px;
        }
    }









</style>
<link rel="icon" type="image/svg+xml" href="{% static 'logo.svg' %}">

<title>Сотрудники</title>

<div class="header">
    <div class="header-container">
        <a class="logo">
            <img src="{% static 'logo.svg' %}" alt="Logo">
        </a>
        <div class="navbar">
            <ul class="menu__box">
                <li><a href="{% url 'main' %}">Дашборд</a></li>
<!--                <li><a href="{% url 'calendar' %}">Календарь</a></li>-->
                <li><a href="{% url 'orders' %}">Заказы</a></li>
                <li><a href="{% url 'active'%}">Активность</a></li>
                <li><a class="active" style="color: white" href="{% url 'staff' %}">Сотрудники</a></li>
            </ul>
        </div>
        <div class="nav-tools">
            <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="25" cy="25" r="25" fill="white" />
              <path d="M23.9216 29.1572C21.9905 29.1572 20.3541 28.4713 19.0125 27.0993C17.6708 25.7274 17 24.054 17 22.0792C17 20.1045 17.6708 18.4311 19.0125 17.0592C20.3541 15.6872 21.9905 15.0008 23.9216 15C25.8535 15 27.4903 15.6864 28.8319 17.0592C30.1736 18.4311 30.8444 20.1045 30.8444 22.0792C30.8444 22.9373 30.6958 23.7678 30.3987 24.5708C30.1007 25.3737 29.7101 26.0605 29.2269 26.6312L36.3635 33.9278C36.4763 34.0431 36.5367 34.1851 36.5447 34.354C36.5528 34.5211 36.4924 34.6706 36.3635 34.8024C36.2347 34.9341 36.0926 35 35.9371 35C35.7801 35 35.6376 34.9341 35.5095 34.8024L28.3729 27.5045C27.7689 28.0307 27.0744 28.4379 26.2892 28.7261C25.504 29.0144 24.7148 29.1585 23.9216 29.1585M23.9216 27.9232C25.5241 27.9232 26.8775 27.3591 27.9815 26.2309C29.0848 25.1027 29.6364 23.7188 29.6364 22.0792C29.6364 20.4405 29.0848 19.057 27.9815 17.9288C26.8783 16.8006 25.5254 16.2365 23.9228 16.2365C22.3202 16.2365 20.9669 16.8006 19.8629 17.9288C18.7596 19.057 18.208 20.4405 18.208 22.0792C18.208 23.718 18.7596 25.1015 19.8629 26.2297C20.9661 27.3579 22.319 27.922 23.9216 27.922" fill="#2A2A28" />
            </svg>
            <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="25" cy="25" r="25" fill="white" />
              <path d="M24.6116 35C24.1272 35 23.7138 34.8278 23.3715 34.4833C23.0292 34.1395 22.858 33.7261 22.858 33.2431H26.3718C26.3718 33.729 26.1995 34.1431 25.855 34.4855C25.5098 34.8285 25.0954 35 24.6116 35ZM17 32.1542V31.0664H18.7569V22.4474C18.7569 21.0259 19.2065 19.776 20.1058 18.6976C21.0065 17.6192 22.1469 16.9472 23.5271 16.6818V16.0878C23.5271 15.7854 23.6326 15.5287 23.8436 15.3177C24.0547 15.1059 24.311 15 24.6127 15C24.9137 15 25.1708 15.1059 25.384 15.3177C25.5965 15.5287 25.7027 15.7854 25.7027 16.0878V16.1694C25.5454 16.4146 25.4076 16.6622 25.2894 16.9124C25.1704 17.1619 25.078 17.4273 25.012 17.7087L24.8183 17.687C24.7552 17.6812 24.6874 17.6783 24.6149 17.6783C23.2928 17.6783 22.1673 18.1424 21.2382 19.0707C20.3099 19.9997 19.8458 21.1253 19.8458 22.4474V31.0664H29.3851V24.4534C29.5577 24.4874 29.7354 24.5139 29.9181 24.5328C30.1023 24.5509 30.2873 24.5531 30.4729 24.5393V31.0664H32.2298V32.1542H17Z" fill="#2A2A28" />
              <path d="M28.0872 21.1735C28.6181 21.7022 29.2606 21.9666 30.0149 21.9666C30.7706 21.9666 31.4113 21.7008 31.9393 21.1713C32.468 20.6412 32.7323 19.999 32.7323 19.2448C32.7309 18.4891 32.4654 17.8473 31.936 17.3193C31.4066 16.7913 30.7648 16.5273 30.0105 16.5273C29.2556 16.5273 28.6137 16.7924 28.085 17.3226C27.5571 17.8527 27.2931 18.4949 27.2931 19.2491C27.2931 20.0041 27.5578 20.6456 28.0872 21.1735Z" fill="#FF0035" />
            </svg>
            <div class="photo-profile"></div>
        </div>
    </div>
</div>

<div class="title-page">
    <div class="title-page-base">База данных сотрудников</div>
    <div class="count-orders"> за все время</div>
</div>

<div class="sorting-block">
    <div class="sorting-panel">
        <div class="sorting-label">
            <div class="sorting-panel-pt">
                <div class="panel-pt">Поиск по ФИО</div>
                <label>
                    <input type="text" name="search_name" placeholder="Вальчук Александр Александрович"> <!-- Добавить поиск по полному ФИО -->
                </label>
            </div>

            <div class="sorting-panel-pt">
                <div class="panel-pt">Статус</div>
                <select name="status">
                    <option value="">Все</option>
                    <option value="working">Работает</option>
                    <option value="not_working">Уволен</option>
                    <option value="probation">Испытательный срок</option>
                </select>
            </div>

            <div class="sorting-panel-pt">
                <div class="panel-pt">Подразделения</div>
                <select name="department">
                    <option value="">Все</option>
                    {% for department in departments %}
                    <option value="{{ department.id }}">{{ department.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="sorting-panel-pt">
                <div class="panel-pt">Оплата</div>
                <select name="payment_type">
                    <option value="">Все</option>
                    <option value="fixed">Фиксированный</option>
                    <option value="not_fixed">Сдельный</option>
                </select>
            </div>
        </div>

        <div class="add-new-staff">
            <a href="{% url 'add_employee' %}" style="display: flex; align-items: center">
                <svg width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M11.4583 13.5417H1.04167C0.745833 13.5417 0.498611 13.4417 0.3 13.2417C0.1 13.0417 0 12.7944 0 12.5C0 12.2056 0.1 11.9583 0.3 11.7583C0.5 11.5583 0.747222 11.459 1.04167 11.4604H11.4583V1.04375C11.4583 0.747916 11.5583 0.500694 11.7583 0.302083C11.9583 0.100694 12.2056 0 12.5 0C12.7944 0 13.0417 0.1 13.2417 0.3C13.4417 0.5 13.541 0.747222 13.5396 1.04167V11.4583H23.9563C24.2521 11.4583 24.4993 11.5583 24.6979 11.7583C24.8979 11.9583 24.9979 12.2063 24.9979 12.5021C24.9979 12.7979 24.8979 13.0451 24.6979 13.2438C24.4979 13.4424 24.2507 13.5417 23.9563 13.5417H13.5396V23.9583C13.5396 24.2542 13.4396 24.5014 13.2396 24.7C13.041 24.9 12.7944 25 12.5 25C12.2056 25 11.9583 24.9 11.7583 24.7C11.5583 24.5 11.459 24.2528 11.4604 23.9583L11.4583 13.5417Z" fill="white" />
                </svg>
                <span class="button-text">Добавить сотрудника</span>
            </a>
        </div>
    </div>
</div>

<div class="employees-table">
    <div style="display: flex; margin-left: 20px; align-items: center; gap: 8px">
        <div class="employees-text">Сотрудники</div>
        <div class="sort-count-emp">31 результат</div>
    </div>
    <table>
        <thead>
            <tr>
                <th style="width: 4.55%;">№</th>
                <th style="width: 17.97%">ФИО</th>
                <th style="width: 15.5%">Должность</th>
                <th style="width: 10%">Подразделение</th>
                <th style="width: 10.67%">Дата принятия</th>
                <th style="width: 8.98%">Статус</th>
                <th style="width: 13.05%">Тип оплаты</th>
                <th style="width: 9.10%">Зарплата</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        <!-- Здесь добавляются сотрудники-->
        </tbody>
    </table>
</div>


<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    function deleteEmployee(employeeId) {
        $.ajax({
            type: 'POST',
            url: '/delete-employee/' + employeeId + '/', // Замените на ваш URL
            dataType: 'json',
            success: function (response) {
                if (response.success) {
                    // Если удаление успешно, обновим таблицу сотрудников
                    fetchEmployees();
                } else {
                    // Если удаление не удалось, выведем сообщение об ошибке
                    alert('Ошибка при удалении сотрудника: ' + response.error);
                }
            },
            error: function () {
                // Если запрос не удался, выведем сообщение об ошибке
                alert('Ошибка при выполнении запроса');
            }
        });
    }
    function fetchEmployees() {
        $.ajax({
            url: '{% url "staff" %}',
            data: {
                'search_name': $('input[name="search_name"]').val(),
                'status': $('select[name="status"]').val(),
                'department': $('select[name="department"]').val(),
                'payment_type': $('select[name="payment_type"]').val(),
            },
            dataType: 'json',
            success: function (data) {
                var tableBody = $('.employees-table tbody');
                var rowCount = data.data.length; // Получаем количество строк в ответе
                tableBody.empty();
                if (rowCount === 0) {
                    tableBody.append('<tr><td colspan="9">Нет данных.</td></tr>');
                    $('.sort-count-emp').text(0 + ' результат');

                } else {
                    $.each(data.data, function(index, employee) {
                        var formattedDate = new Date(employee.employment_date).toLocaleDateString('ru-RU');
                        var statusClass = employee.status;
                        var typeSalary = employee.type_salary;
                        if (employee.type_salary === "Фиксированный") {
                            typeSalary = "fixed"
                        } else if (employee.type_salary === "Сдельный") {
                            typeSalary = "not_fixed"
                        }


                        if (employee.status === "Работает") {
                            statusClass = "working";
                        } else if (employee.status === "Уволен") {
                            statusClass = "not_working";
                        } else if (employee.status === "Испытательный срок") {
                            statusClass = "probation";
                        }

                        tableBody.append(
                            '<tr data-employee-id="' + employee.id + '">' +
                            '<td style="font-weight: 600">' + (index + 1) + '</td>' +
                            '<td style="font-weight: 600">' + employee.full_name + '</td>' +
                            '<td>' + employee.position + '</td>' +
                            '<td>' + employee.department + '</td>' +
                            '<td style="display: flex; align-items: center; gap: 5px"> ' +
                            '                    <svg width="18" height="21" viewBox="0 0 18 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
                            '                      <path d="M1.77171 20.5C1.26707 20.5 0.845812 20.3311 0.507926 19.9932C0.169308 19.6546 0 19.2329 0 18.7283V4.71919C0 4.21455 0.169308 3.79329 0.507926 3.45541C0.845812 3.11679 1.26707 2.94748 1.77171 2.94748H3.71346V1.0913C3.71346 0.920895 3.7694 0.779743 3.8813 0.667846C3.99247 0.555949 4.13325 0.5 4.30366 0.5C4.47406 0.5 4.61522 0.555949 4.72711 0.667846C4.83901 0.779743 4.89496 0.920895 4.89496 1.0913V2.94748H12.742V1.04961C12.742 0.893103 12.7947 0.762557 12.9 0.657973C13.0053 0.553389 13.1355 0.500731 13.2905 0.5C13.4471 0.5 13.5776 0.552292 13.6822 0.656876C13.7868 0.761459 13.8391 0.892006 13.8391 1.04852V2.94748H15.7808C16.2854 2.94748 16.7067 3.11679 17.0446 3.45541C17.3832 3.79329 17.5525 4.21455 17.5525 4.71919V18.7283C17.5525 19.2329 17.3836 19.6542 17.0457 19.9921C16.7071 20.3307 16.2854 20.5 15.7808 20.5H1.77171ZM1.77171 19.403H15.7808C15.949 19.403 16.1037 19.3328 16.2449 19.1923C16.3853 19.0512 16.4555 18.8965 16.4555 18.7283V9.10732H1.09703V18.7283C1.09703 18.8965 1.16724 19.0512 1.30766 19.1923C1.44881 19.3328 1.6035 19.403 1.77171 19.403ZM8.77626 12.9897C8.54954 12.9897 8.35207 12.9056 8.18386 12.7374C8.01565 12.5692 7.93154 12.3717 7.93154 12.145C7.93154 11.919 8.01565 11.7219 8.18386 11.5537C8.35207 11.3855 8.54954 11.3014 8.77626 11.3014C9.00298 11.3014 9.20045 11.3855 9.36866 11.5537C9.53687 11.7219 9.62098 11.9194 9.62098 12.1461C9.62098 12.3728 9.53687 12.5699 9.36866 12.7374C9.20045 12.9056 9.00298 12.9897 8.77626 12.9897ZM4.38813 12.9897C4.16141 12.9897 3.96394 12.9056 3.79573 12.7374C3.62752 12.5692 3.54342 12.3717 3.54342 12.145C3.54342 11.919 3.62752 11.7219 3.79573 11.5537C3.96394 11.3855 4.16141 11.3014 4.38813 11.3014C4.61485 11.3014 4.81232 11.3855 4.98053 11.5537C5.14874 11.7219 5.23285 11.9194 5.23285 12.1461C5.23285 12.3728 5.14874 12.5699 4.98053 12.7374C4.81232 12.9056 4.61485 12.9897 4.38813 12.9897ZM13.1644 12.9897C12.9377 12.9897 12.7402 12.9056 12.572 12.7374C12.4038 12.5692 12.3197 12.3717 12.3197 12.145C12.3197 11.919 12.4038 11.7219 12.572 11.5537C12.7402 11.3855 12.9377 11.3014 13.1644 11.3014C13.3911 11.3014 13.5886 11.3855 13.7568 11.5537C13.925 11.7219 14.0091 11.9194 14.0091 12.1461C14.0091 12.3728 13.925 12.5699 13.7568 12.7374C13.5886 12.9056 13.3911 12.9897 13.1644 12.9897ZM8.77626 17.2089C8.54954 17.2089 8.35207 17.1248 8.18386 16.9566C8.01565 16.7884 7.93154 16.5909 7.93154 16.3642C7.93154 16.1382 8.01565 15.9411 8.18386 15.7729C8.35207 15.6047 8.54954 15.5206 8.77626 15.5206C9.00298 15.5206 9.20045 15.6047 9.36866 15.7729C9.53687 15.9411 9.62098 16.1386 9.62098 16.3653C9.62098 16.592 9.53687 16.7895 9.36866 16.9577C9.20045 17.1252 9.00298 17.2089 8.77626 17.2089ZM4.38813 17.2089C4.16141 17.2089 3.96394 17.1248 3.79573 16.9566C3.62752 16.7884 3.54342 16.5909 3.54342 16.3642C3.54342 16.1382 3.62752 15.9411 3.79573 15.7729C3.96394 15.6047 4.16141 15.5206 4.38813 15.5206C4.61485 15.5206 4.81232 15.6047 4.98053 15.7729C5.14874 15.9411 5.23285 16.1386 5.23285 16.3653C5.23285 16.592 5.14874 16.7895 4.98053 16.9577C4.81232 17.1252 4.61485 17.2089 4.38813 17.2089ZM13.1644 17.2089C12.9377 17.2089 12.7402 17.1248 12.572 16.9566C12.4038 16.7884 12.3197 16.5909 12.3197 16.3642C12.3197 16.1382 12.4038 15.9411 12.572 15.7729C12.7402 15.6047 12.9377 15.5206 13.1644 15.5206C13.3911 15.5206 13.5886 15.6047 13.7568 15.7729C13.925 15.9411 14.0091 16.1386 14.0091 16.3653C14.0091 16.592 13.925 16.7895 13.7568 16.9577C13.5886 17.1252 13.3911 17.2089 13.1644 17.2089Z" fill="#A5A5A5" />\n' +
                            '                   </svg>' + formattedDate + '</td>' +
                            '<td><div class="' + statusClass + '">' + employee.status + '</div>' + '</td>' +
                            '<td><div class="' + typeSalary + '">' + employee.type_salary + '</td>' +
                            '<td style="font-weight: 600">' + parseInt(employee.salary).toLocaleString('ru-RU') + ' ₽</td>' +
                            '<td style="gap: 20px; display: flex; align-items: center;">' +
                            '     <svg class="refactor-employee-button" width="34" height="31" viewBox="0 0 34 31" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
                            '       <path d="M0 19.6667V17.5833H14.5833V19.6667H0ZM0 11.3333V9.25H22.9167V11.3333H0ZM0 3V0.916668H22.9167V3H0ZM17.1458 30.0833V25.4792L28.2562 14.4229C28.4632 14.2424 28.6757 14.1104 28.8937 14.0271C29.1118 13.9438 29.3306 13.9007 29.55 13.8979C29.7889 13.8979 30.0236 13.9424 30.2542 14.0313C30.4833 14.1215 30.6924 14.2556 30.8812 14.4333L32.8083 16.4021C32.9792 16.6076 33.1097 16.8208 33.2 17.0417C33.2903 17.2625 33.3347 17.4847 33.3333 17.7083C33.3319 17.9319 33.2958 18.1556 33.225 18.3792C33.1542 18.6028 33.0153 18.8181 32.8083 19.025L21.75 30.0833H17.1458ZM29.5625 19.6979L31.4896 17.7083L29.5625 15.7396L27.5833 17.7188L29.5625 19.6979Z" />\n' +
                            '     </svg>' +
                            '     <svg class="delete-employee-button" width="27" height="31" viewBox="0 0 27 31" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
                            '       <path d="M12.6987 21.5742H14.6011V12.6541L18.596 16.6281L19.9429 15.2812L13.6499 8.98827L7.35696 15.2812L8.70382 16.6281L12.6987 12.6541V21.5742ZM5.30813 30.5C4.43305 30.5 3.70255 30.207 3.11663 29.6211C2.53071 29.0352 2.23711 28.3041 2.23584 27.4277V3.86715H0.333496V1.96481H7.94288V0.5H19.357V1.96481H26.9663V3.86715H25.064V27.4277C25.064 28.3028 24.771 29.0333 24.1851 29.6192C23.5992 30.2051 22.8681 30.4987 21.9917 30.5H5.30813Z" />\n' +
                            '     </svg>' +
                            '</td>' +

                            '</tr>'

                    )
                        ;
                    });
                    $('.sort-count-emp').text(rowCount + ' результат');
                }
                $('.count-orders').text(data.total_count + ' за все время');

            }
        });
    }


    // Подписываемся на изменения полей фильтра
    $('input[name="search_name"], select').on('change input', fetchEmployees); // Добавлено событие input
    fetchEmployees();  // Инициализация при загрузке страницы


    $(document).on('click', '.delete-employee-button', function() {
        var employeeId = $(this).closest('tr').data('employee-id');
        if (confirm('Вы уверены, что хотите удалить этого сотрудника?')) {
            deleteEmployee(employeeId);
        }
    });

    $(document).on('click', '.refactor-employee-button', function(e) {
        e.preventDefault(); // Предотвращаем стандартное поведение
        var employeeId = $(this).closest('tr').data('employee-id');
        var url = '/refactor_employee/' + employeeId + '/'; // Формируем URL
        window.location.href = url; // Переадресация на URL
    });

});
</script>


{% endblock %}